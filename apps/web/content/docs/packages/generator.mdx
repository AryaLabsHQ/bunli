---
title: '@bunli/generator'
description: Generate TypeScript definitions from CLI commands for enhanced developer experience
---

import { Tabs, Tab } from 'fumadocs-ui/components/tabs';
import { Callout } from 'fumadocs-ui/components/callout';
import { Card, Cards } from 'fumadocs-ui/components/card';

# @bunli/generator

Generate TypeScript definitions from your CLI commands to enable advanced patterns like CLI wrappers, documentation generation, and command analytics.

<Callout type="info">
  @bunli/generator has **minimal dependencies** and uses Babel for AST parsing to extract command metadata from your TypeScript files.
</Callout>

## Installation

<Tabs groupId="package-manager" defaultValue="bun">
  <Tab value="bun" label="Bun">
    ```bash
    bun add @bunli/generator
    ```
  </Tab>
  <Tab value="npm" label="npm">
    ```bash
    npm install @bunli/generator
    ```
  </Tab>
  <Tab value="pnpm" label="pnpm">
    ```bash
    pnpm add @bunli/generator
    ```
  </Tab>
</Tabs>

## Features

- üöÄ **Fast Generation** - Uses Babel for efficient AST parsing
- üìù **Type Safety** - Generates fully typed TypeScript definitions
- üîÑ **Watch Mode** - Automatically regenerate on file changes
- üéØ **Command Discovery** - Scans and parses command files automatically
- üîå **Plugin Integration** - Works seamlessly with Bunli's plugin system
- ‚ö° **Build Integration** - Integrates with `bunli dev` and `bunli build`
- üõ†Ô∏è **CLI Tool** - Standalone `bunli generate` command

## Core APIs

### Generator Class

The main class for generating TypeScript definitions:

```typescript
import { Generator } from '@bunli/generator'

const generator = new Generator({
  commandsDir: './commands',
  outputFile: './.bunli/commands.gen.ts'
})

// Generate types once
await generator.run()

// Generate with specific options
await generator.run({
  type: 'update',
  path: './commands/new-command.ts'
})
```

### CommandScanner

Scans directories for command files:

```typescript
import { CommandScanner } from '@bunli/generator'

const scanner = new CommandScanner('./commands')
const files = await scanner.scan()

console.log(files) // ['greet.ts', 'deploy.ts', 'test.ts']
```

### parseCommand Function

Parse individual command files:

```typescript
import { parseCommand } from '@bunli/generator'

const commandData = await parseCommand('./commands/greet.ts')
console.log(commandData)
// {
//   name: 'greet',
//   description: 'Greet someone',
//   options: { ... },
//   alias: ['hello']
// }
```

### buildTypes Function

Build TypeScript definitions from command data:

```typescript
import { buildTypes } from '@bunli/generator'

const commands = [
  { name: 'greet', description: 'Greet someone', options: { ... } },
  { name: 'deploy', description: 'Deploy app', options: { ... } }
]

const types = buildTypes(commands)
console.log(types) // Generated TypeScript code
```

## Plugin Integration

### bunliCodegenPlugin

Use as a Bun plugin for build integration:

```typescript
import { bunliCodegenPlugin } from '@bunli/generator'

// In your build configuration
export default {
  plugins: [
    bunliCodegenPlugin({
      commandsDir: './commands',
      output: './.bunli/commands.gen.ts'
    })
  ]
}
```

### CLI Integration

The generator is automatically integrated with Bunli CLI commands:

```bash
# Development mode with watch
bunli dev

# Build with type generation
bunli build

# Standalone generation
bunli generate --watch
```

## Configuration Options

<Card title="Generator Options" description="Configuration for type generation">

| Option | Type | Default | Description |
|--------|------|---------|-------------|
| `commandsDir` | `string` | `'./commands'` | Directory to scan for command files |
| `outputFile` | `string` | `'./.bunli/commands.gen.ts'` | Output file for generated types |
| `watch` | `boolean` | `false` | Watch for file changes |
| `include` | `string[]` | `['**/*.ts', '**/*.js']` | File patterns to include |
| `exclude` | `string[]` | `['**/*.test.*', '**/*.spec.*']` | File patterns to exclude |

</Card>

## Generated Output Structure

The generator creates a comprehensive TypeScript API:

### CommandRegistry Interface

```typescript
interface CommandRegistry {
  [commandName: string]: {
    name: string
    description: string
    alias?: string[]
    options: {
      [optionName: string]: {
        type: 'string' | 'number' | 'boolean' | 'array' | 'object'
        required: boolean
        default?: any
        description: string
        short?: string
      }
    }
  }
}
```

### Helper Functions

```typescript
// Get command API by name
function getCommandApi<T extends keyof CommandRegistry>(name: T): CommandRegistry[T]

// Get all command names
function getCommandNames(): (keyof CommandRegistry)[]

// Check if command exists
function hasCommand(name: string): name is keyof CommandRegistry

// Get command by alias
function getCommandByAlias(alias: string): keyof CommandRegistry | undefined

// List all commands with metadata
function listCommands(): Array<{
  name: keyof CommandRegistry
  description: string
  alias?: string[]
}>
```

## Usage Patterns

### Basic Generation

```typescript
import { Generator } from '@bunli/generator'

const generator = new Generator({
  commandsDir: './src/commands',
  outputFile: './.bunli/commands.gen.ts'
})

await generator.run()
```

### Watch Mode

```typescript
const generator = new Generator({
  commandsDir: './commands',
  outputFile: './.bunli/commands.gen.ts',
  watch: true
})

// Watch for changes and regenerate automatically
await generator.run()
```

### Custom File Patterns

```typescript
const generator = new Generator({
  commandsDir: './src/commands',
  outputFile: './.bunli/commands.gen.ts',
  include: ['**/*.command.ts', '**/*.cmd.ts'],
  exclude: ['**/*.test.*', '**/*.spec.*', '**/index.ts']
})
```

## Performance Characteristics

- **Scanning**: ~10ms for 50 command files
- **Parsing**: ~5ms per command file
- **Generation**: ~2ms for 20 commands
- **Watch Mode**: <1ms incremental updates
- **Memory Usage**: ~2MB for 100 commands

<Callout type="tip">
  Performance scales linearly with the number of command files. For CLIs with 100+ commands, consider using command manifests for lazy loading.
</Callout>

## API Reference

### Generator

```typescript
class Generator {
  constructor(options: GeneratorOptions)
  
  // Generate types once
  run(options?: RunOptions): Promise<void>
  
  // Watch for changes
  watch(): Promise<void>
  
  // Stop watching
  stop(): void
}
```

### GeneratorOptions

```typescript
interface GeneratorOptions {
  commandsDir: string
  outputFile: string
  watch?: boolean
  include?: string[]
  exclude?: string[]
}
```

### RunOptions

```typescript
interface RunOptions {
  type?: 'update' | 'delete'
  path?: string
}
```

### CommandData

```typescript
interface CommandData {
  name: string
  description: string
  alias?: string[]
  options: Record<string, OptionData>
}

interface OptionData {
  type: 'string' | 'number' | 'boolean' | 'array' | 'object'
  required: boolean
  default?: any
  description: string
  short?: string
}
```

## Integration Examples

### With Bunli CLI

```typescript
// bunli.config.ts
export default defineConfig({
  name: 'my-cli',
  version: '1.0.0',
})
```

### With Custom Build Script

```typescript
// build.ts
import { Generator } from '@bunli/generator'

const generator = new Generator({
  commandsDir: './src/commands',
  outputFile: './.bunli/commands.gen.ts'
})

await generator.run()
console.log('Types generated successfully')
```

### With File Watching

```typescript
import { watch } from 'node:fs/promises'
import { Generator } from '@bunli/generator'

const generator = new Generator({
  commandsDir: './commands',
  outputFile: './.bunli/commands.gen.ts'
})

// Initial generation
await generator.run()

// Watch for changes
const watcher = watch('./commands', { recursive: true })
for await (const event of watcher) {
  if (event.eventType === 'change') {
    await generator.run({
      type: 'update',
      path: event.filename
    })
  }
}
```

## Troubleshooting

### Common Issues

**Generation fails:**
- Check that command files use `defineCommand`
- Verify TypeScript syntax is correct
- Ensure commands are properly exported

**Types not updating:**
- Make sure watch mode is enabled
- Check file paths are correct
- Verify no syntax errors in command files

**Import errors:**
- Ensure generated file exists
- Check import paths are correct
- Verify TypeScript configuration

### Debug Mode

Enable verbose logging:

```typescript
const generator = new Generator({
  commandsDir: './commands',
  outputFile: './.bunli/commands.gen.ts',
  verbose: true // Enable debug output
})
```

## See Also

- [Type Generation Guide](/docs/guides/type-generation) - Complete guide to using generated types
- [bunli CLI](/docs/packages/cli) - CLI toolchain with integrated generation
- [Configuration](/docs/core-concepts/configuration) - Configure code generation
- [@bunli/core](/docs/packages/core) - Core framework with type utilities
